---
// src/pages/[lang]/blog/[...slug].astro

import { getCollection, type CollectionEntry } from 'astro:content';

import BaseLayout from '../../../layouts/BaseLayout.astro';
import Banner from '../../../components/sections/Banner.astro';
import BlogBanner from '../../../assets/images/bg/bg-blog.webp';
import CallToAction from '../../../components/sections/CallToAction.astro';
import CTA from '../../../assets/images/cta.webp';

export async function getStaticPaths() {
	const posts = await getCollection('posts');

	return posts.map((post: CollectionEntry<'posts'>) => {
		const slug = post.data.slug;

		return {
			params: {
				lang: post.data.lang,
				slug: slug,
			},
			props: { post },
		};
	});
}

const { post } = Astro.props as { post: CollectionEntry<'posts'> };
const { lang = 'es' } = Astro.params as { lang?: string };

if (!post) {
	throw new Error('Post no encontrado');
}

const { title, image, date } = post.data;
const { Content } = await post.render();
---

<BaseLayout lang={lang} title={title}>
	<Banner imageSrc={BlogBanner} key="blog" lang={lang} />
	<section class="responsive flex w-full flex-col gap-4">
		<div class="h-[500px] w-full shadow-lg">
			<img src={image} alt={title} class="radius h-full w-full object-cover" />
		</div>
		<div class="radius flex flex-col gap-4 p-8 text-center">
			<h1 class="heading textShadow text-center">
				{title}
			</h1>
			<small class="leading">{date}</small>
			<article class="main prose p-4 text-center">
				<Content />
			</article>
		</div>
	</section>
	<CallToAction lang={lang} imageSrc={CTA} />
</BaseLayout>
