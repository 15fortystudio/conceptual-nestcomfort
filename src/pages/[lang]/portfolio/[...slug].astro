---
// src/pages/[lang]/portfolio/page/[...slug].astro

// ----- Components

import BaseLayout from '../../../layouts/BaseLayout.astro';
import Banner from '../../../components/sections/Banner.astro';
import CallToAction from '../../../components/sections/CallToAction.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

// ----- Image

import PortfolioBanner from '../../../assets/images/bg/bg-portfolio.webp';
import CTA from '../../../assets/images/cta.webp';

// ----- Function

export async function getStaticPaths() {
	const projects = await getCollection('projects');

	return projects.map((project: CollectionEntry<'projects'>) => {
		const slug = project.data.slug;

		return {
			params: {
				lang: project.data.lang,
				slug: slug,
			},
			props: { project },
		};
	});
}

const { project } = Astro.props as { project: CollectionEntry<'projects'> };
const { lang = 'es' } = Astro.params as { lang?: string };

if (!project) {
	throw new Error('project no encontrado');
}

const locale = lang === 'en' ? 'en-US' : 'es-MX';

const { title, image, date } = project.data;
const formattedDate = new Date(date).toLocaleDateString(locale, {
	weekday: 'short',
	day: 'numeric',
	month: 'long',
	year: 'numeric',
});

const { Content } = await project.render();
---

<BaseLayout lang={lang}>
	<Banner imageSrc={PortfolioBanner} key="portfolio" lang={lang} />
	<section class="flex w-full flex-col gap-4">
		<div class="flex h-100 flex-col gap-2 overflow-hidden py-4 md:h-150 xl:h-220">
			<img src={image} alt={title} class="radius h-3/4 w-full object-cover shadow-2xl" />
			<div class="flex h-1/4 w-full gap-2">
				<img src={image} alt={title} class="radius h-full w-full object-cover shadow-2xl" /><img
					src={image}
					alt={title}
					class="radius h-full w-full object-cover shadow-2xl"
				/><img src={image} alt={title} class="radius h-full w-full object-cover shadow-2xl" /><img
					src={image}
					alt={title}
					class="radius h-full w-full object-cover shadow-2xl"
				/><img src={image} alt={title} class="radius h-full w-full object-cover shadow-2xl" />
			</div>
		</div>

		<div class="flex flex-col gap-4 p-8 text-center">
			<h1 class="heading textShadow text-center">
				{title}
			</h1>
			<small class="leading">{formattedDate}</small>
			<article class="main prose responsive mx-auto flex flex-col gap-4 p-4 text-left">
				<Content />
			</article>
		</div>
	</section>
	<CallToAction lang={lang} imageSrc={CTA} />
</BaseLayout>
