---
// src/components/TestimonyCard.astro

const { author = 'Autor desconocido', image, testimony, date, stars = '0' } = Astro.props;
const starCount = parseFloat(stars);
---

<article
	class="bg-accent radius flex h-[300px] w-[420px] flex-col gap-4 border-2 border-neutral-500 p-8 text-left shadow-xl sm:h-[400px] sm:w-[400px]"
>
	<div class="flex" aria-label={`Calificación de ${starCount} estrellas`}>
		{
			Array.from({ length: 5 }).map((_, i) => {
				const full = i < Math.floor(starCount);
				const half = i === Math.floor(starCount) && starCount % 1 >= 0.5;

				if (full) {
					// Estrella llena
					return (
						<svg class="h-4 w-4 text-neutral-600" fill="currentColor" viewBox="0 0 20 20">
							<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.967a1 1 0 00.95.69h4.176c.969 0 1.371 1.24.588 1.81l-3.384 2.46a1 1 0 00-.364 1.118l1.286 3.966c.3.921-.755 1.688-1.539 1.118L10 13.348l-3.384 2.46c-.784.57-1.838-.197-1.539-1.118l1.286-3.966a1 1 0 00-.364-1.118L2.615 9.394c-.783-.57-.38-1.81.588-1.81h4.176a1 1 0 00.95-.69l1.286-3.967z" />
						</svg>
					);
				} else if (half) {
					// Media estrella
					return (
						<svg class="h-4 w-4 text-neutral-600" viewBox="0 0 20 20">
							<defs>
								<linearGradient id="half-gradient" x1="0" x2="100%" y1="0" y2="0">
									<stop offset="50%" stop-color="currentColor" />
									<stop offset="50%" stop-color="lightgray" />
								</linearGradient>
							</defs>
							<path
								fill="url(#half-gradient)"
								d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.967a1 1 0 00.95.69h4.176c.969 0 1.371 1.24.588 1.81l-3.384 2.46a1 1 0 00-.364 1.118l1.286 3.966c.3.921-.755 1.688-1.539 1.118L10 13.348l-3.384 2.46c-.784.57-1.838-.197-1.539-1.118l1.286-3.966a1 1 0 00-.364-1.118L2.615 9.394c-.783-.57-.38-1.81.588-1.81h4.176a1 1 0 00.95-.69l1.286-3.967z"
							/>
						</svg>
					);
				} else {
					// Estrella vacía
					return (
						<svg class="h-4 w-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
							<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.967a1 1 0 00.95.69h4.176c.969 0 1.371 1.24.588 1.81l-3.384 2.46a1 1 0 00-.364 1.118l1.286 3.966c.3.921-.755 1.688-1.539 1.118L10 13.348l-3.384 2.46c-.784.57-1.838-.197-1.539-1.118l1.286-3.966a1 1 0 00-.364-1.118L2.615 9.394c-.783-.57-.38-1.81.588-1.81h4.176a1 1 0 00.95-.69l1.286-3.967z" />
						</svg>
					);
				}
			})
		}
	</div>

	<blockquote class="mt-8 text-gray-700">
		<span class="p-fixed">"{testimony}"</span>
	</blockquote>
	<div class="m-auto flex gap-8">
		<img
			src={image}
			alt={`Foto de ${author}`}
			class="my-auto h-16 w-16 rounded-full object-cover"
		/>
		<div class="flex flex-col justify-between text-center">
			<p class="mt-4 font-semibold">— {author}</p>
			<time datetime={date} class="leading">{date}</time>
		</div>
	</div>
</article>
